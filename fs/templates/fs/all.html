{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文件列表</title>
    <link rel="stylesheet" href="{% static 'fs/css/all.css' %}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📁 文件列表</h1>
            <div class="toolbar">
                <div class="search-box">
                    <span class="search-icon">🔍</span>
                    <input type="text" id="searchInput" placeholder="搜索文件..." oninput="debounceSearch()">
                </div>
                <div class="view-toggle">
                    <button class="view-btn active" onclick="switchView('list')" title="列表视图">☰</button>
                    <button class="view-btn" onclick="switchView('card')" title="卡片视图">⊞</button>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="filters">
                <div class="filter-group">
                    <label class="filter-label">文件类型</label>
                    <select class="filter-select" id="typeFilter" onchange="loadFiles()">
                        <option value="">全部</option>
                        <optgroup label="图片">
                            <option value="category:image">图片</option>
                            <option value="jpg">JPG</option>
                            <option value="png">PNG</option>
                            <option value="gif">GIF</option>
                            <option value="webp">WEBP</option>
                            <option value="bmp">BMP</option>
                        </optgroup>
                        <optgroup label="视频">
                            <option value="category:video">视频</option>
                            <option value="mp4">MP4</option>
                            <option value="avi">AVI</option>
                            <option value="mov">MOV</option>
                            <option value="mkv">MKV</option>
                        </optgroup>
                        <optgroup label="音频">
                            <option value="category:audio">音频</option>
                            <option value="mp3">MP3</option>
                            <option value="wav">WAV</option>
                            <option value="flac">FLAC</option>
                        </optgroup>
                        <optgroup label="文档">
                            <option value="category:document">文档</option>
                            <option value="pdf">PDF</option>
                            <option value="doc">DOC</option>
                            <option value="docx">DOCX</option>
                            <option value="txt">TXT</option>
                        </optgroup>
                        <optgroup label="压缩">
                            <option value="category:archive">压缩</option>
                            <option value="zip">ZIP</option>
                            <option value="rar">RAR</option>
                            <option value="7z">7Z</option>
                        </optgroup>
                        <optgroup label="代码">
                            <option value="category:code">代码</option>
                        </optgroup>
                        <optgroup label="其他">
                            <option value="category:other">其他类型</option>
                        </optgroup>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">文件级别</label>
                    <select class="filter-select" id="levelFilter" onchange="loadFiles()">
                        <option value="">全部</option>
                        <option value="General">普通</option>
                        <option value="Important">重要</option>
                        <option value="Private">私密</option>
                        <option value="Public">公开</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">文件状态</label>
                    <select class="filter-select" id="statusFilter" onchange="loadFiles()">
                        <option value="all">全部</option>
                        <option value="enable">正常</option>
                        <option value="deleted">已删除</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">作者</label>
                    <input type="text" class="filter-input" id="authorFilter" placeholder="输入作者..." oninput="debounceSearch()">
                </div>
                <div class="filter-group">
                    <label class="filter-label">专辑</label>
                    <input type="text" class="filter-input" id="albumFilter" placeholder="输入专辑..." oninput="debounceSearch()">
                </div>
            </div>

            <div class="list-view active" id="listView"></div>
            <div class="card-view" id="cardView"></div>

            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <!-- 编辑模态框 -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">编辑文件信息</h2>
                <button class="close-btn" onclick="closeEditModal()">×</button>
            </div>
            <form id="editForm" onsubmit="saveFileInfo(event)">
                <input type="hidden" id="editFileId">
                
                <div class="form-group">
                    <label class="form-label">文件名</label>
                    <input type="text" class="form-input" id="editName" required>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label class="form-label">作者</label>
                        <input type="text" class="form-input" id="editAuthor">
                    </div>
                    <div class="form-group">
                        <label class="form-label">文件级别</label>
                        <select class="form-select" id="editLevel">
                            <option value="General">普通</option>
                            <option value="Important">重要</option>
                            <option value="Private">私密</option>
                            <option value="Public">公开</option>
                        </select>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label class="form-label">专辑</label>
                        <input type="text" class="form-input" id="editAlbum">
                    </div>
                    <div class="form-group">
                        <label class="form-label">主题</label>
                        <input type="text" class="form-input" id="editSubject">
                    </div>
                </div>

                <div class="category-tag-selector">
                    <div class="selector-group">
                        <label>分类</label>
                        <div class="selector-multi" id="editCategorySelector"></div>
                    </div>
                    <div class="selector-group">
                        <label>标签</label>
                        <div class="selector-multi" id="editTagSelector"></div>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 15px;">
                    <label class="form-label">备注</label>
                    <textarea class="form-textarea" id="editRemark"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeEditModal()">取消</button>
                    <button type="submit" class="btn btn-submit">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 查看器模态框 -->
    <div class="viewer-modal" id="viewerModal">
        <div class="viewer-content">
            <button class="viewer-close" onclick="closeViewer()">×</button>
            <div id="viewerContent"></div>
        </div>
    </div>

    <!-- 生成缩略图确认弹窗 -->
    <div class="modal" id="thumbnailConfirmModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">🖼️ 生成缩略图</h2>
                <button class="close-btn" onclick="closeThumbnailModal()">×</button>
            </div>
            <div style="padding: 20px 0;">
                <p style="margin-bottom: 15px; color: #666; line-height: 1.6;">
                    确定要为文件 <strong id="thumbnailFileName"></strong> 生成缩略图吗？
                </p>
                <p style="color: #999; font-size: 13px; margin-top: 10px;">
                    💡 提示：生成缩略图可能需要几秒钟时间，请耐心等待。
                </p>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-cancel" onclick="closeThumbnailModal()">取消</button>
                <button type="button" class="btn btn-submit" onclick="confirmGenerateThumbnail()">确定生成</button>
            </div>
        </div>
    </div>

    <!-- 转换为HLS确认弹窗 -->
    <div class="modal" id="hlsConfirmModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">🎬 转换为HLS格式</h2>
                <button class="close-btn" onclick="closeHLSModal()">×</button>
            </div>
            <div style="padding: 20px 0;">
                <p style="margin-bottom: 15px; color: #666; line-height: 1.6;">
                    确定要将文件 <strong id="hlsFileName"></strong> 转换为HLS格式吗？
                </p>
                <p style="color: #999; font-size: 13px; margin-top: 10px;">
                    💡 提示：转换可能需要较长时间，请耐心等待。转换后的HLS文件将保存在数据块目录下的HLS子目录中。
                </p>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-cancel" onclick="closeHLSModal()">取消</button>
                <button type="button" class="btn btn-submit" onclick="confirmConvertHLS()">确定转换</button>
            </div>
        </div>
    </div>

    <!-- 引入 hls.js 库 -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="{% static 'fs/js/all.js' %}"></script>
</body>
</html>

