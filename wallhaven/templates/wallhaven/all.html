{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallhaven æ•°æ®å±•ç¤º</title>
    <!-- åŸºç¡€æ ·å¼ -->
    <link rel="stylesheet" href="{% static 'wallhaven/css/base.css' %}">
    <!-- æ•°æ®å±•ç¤ºé¡µé¢æ ·å¼ -->
    <link rel="stylesheet" href="{% static 'wallhaven/css/all.css' %}">
</head>
<body>
    <div class="container">
        {% csrf_token %}
        <a href="{% url 'wallhaven:index' %}" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <h1>Wallhaven æ•°æ®å±•ç¤º</h1>
        <p class="subtitle">æ‰€æœ‰å·²é‡‡é›†çš„å£çº¸æ•°æ®</p>

        <div class="stats">
            <div class="stat-item">æ€»è®¡: {{ paginator.count }} æ¡è®°å½•</div>
            <div class="stat-item">æœ¬é¡µæ˜¾ç¤º: {{ wallpapers|length }} æ¡</div>
            <div class="stat-item">å½“å‰é¡µ: {{ wallpapers.number }}/{{ paginator.num_pages }}</div>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>åˆ†è¾¨ç‡</th>
                        <th>å®½é«˜æ¯”</th>
                        <th>æ–‡ä»¶å¤§å°</th>
                        <th>çº¯å‡€åº¦</th>
                        <th>åˆ†ç±»</th>
                        <th>æµè§ˆæ¬¡æ•°</th>
                        <th>æ”¶è—æ¬¡æ•°</th>
                        <th>å£çº¸URL</th>
                        <th>ä¸‹è½½çŠ¶æ€</th>
                    </tr>
                </thead>
                <tbody>
                    {% for wallpaper in wallpapers %}
                    <tr>
                        <td>
                            <span class="file-name" 
                                  {% if "å·²ä¸‹è½½" in wallpaper.download_status or "success" in wallpaper.download_status|lower or "å®Œæˆ" in wallpaper.download_status or "å·²" in wallpaper.download_status %}
                                  data-wallpaper-url="{% url 'wallhaven:get_local_wallpaper' wallpaper.id %}"
                                  {% else %}
                                  data-wallpaper-url="{{ wallpaper.path|default:wallpaper.url }}"
                                  {% endif %}
                                  title="ID: {{ wallpaper.id }}">
                                {{ wallpaper.id }}
                            </span>
                        </td>
                        <td>{{ wallpaper.resolution }}</td>
                        <td>{{ wallpaper.ratio }}</td>
                        <td class="file-size">{{ wallpaper.file_size|filesizeformat }}</td>
                        <td>
                            <span class="purity-badge purity-{{ wallpaper.purity|lower }}">
                                {{ wallpaper.purity|upper }}
                            </span>
                        </td>
                        <td>{{ wallpaper.category }}</td>
                        <td>{{ wallpaper.views }}</td>
                        <td>{{ wallpaper.favorites }}</td>
                        <td class="url-cell">
                            {% if "å·²ä¸‹è½½" in wallpaper.download_status or "success" in wallpaper.download_status|lower or "å®Œæˆ" in wallpaper.download_status or "å·²" in wallpaper.download_status %}
                            <a href="{% url 'wallhaven:get_local_wallpaper' wallpaper.id %}" target="_blank" class="url-link">æœ¬åœ°å£çº¸ (å·²ä¸‹è½½)</a>
                            {% else %}
                            <a href="{{ wallpaper.path|default:wallpaper.url }}" target="_blank" class="url-link" data-full-url="{{ wallpaper.path|default:wallpaper.url }}">{{ wallpaper.path|default:wallpaper.url|truncatechars:30 }}</a>
                            {% endif %}
                        </td>
                        <td>
                            {% if "æœªä¸‹è½½" in wallpaper.download_status or "pending" in wallpaper.download_status|lower or "æœªå®Œæˆ" in wallpaper.download_status %}
                                <span class="download-icon" data-wallpaper-id="{{ wallpaper.id }}" title="æœªä¸‹è½½ - ç‚¹å‡»ä¸‹è½½">â¬‡ï¸</span>
                            {% elif "å·²ä¸‹è½½" in wallpaper.download_status or "success" in wallpaper.download_status|lower or "å®Œæˆ" in wallpaper.download_status or "å·²" in wallpaper.download_status %}
                                <span class="view-icon" title="å·²ä¸‹è½½ - ç‚¹å‡»æŸ¥çœ‹">ğŸ‘ï¸</span>
                            {% else %}
                                <span class="status-badge status-{{ wallpaper.download_status|lower }}">
                                    {{ wallpaper.download_status }}
                                </span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="10" style="text-align: center; padding: 40px; color: #999;">
                            æš‚æ— æ•°æ®
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if paginator.num_pages > 1 %}
        <div class="pagination">
            {% if wallpapers.has_previous %}
                <a href="?page=1"><button>é¦–é¡µ</button></a>
                <a href="?page={{ wallpapers.previous_page_number }}"><button>ä¸Šä¸€é¡µ</button></a>
            {% else %}
                <button disabled>é¦–é¡µ</button>
                <button disabled>ä¸Šä¸€é¡µ</button>
            {% endif %}

            <span class="page-info">
                ç¬¬ {{ wallpapers.number }} é¡µ / å…± {{ paginator.num_pages }} é¡µ
            </span>

            {% if wallpapers.has_next %}
                <a href="?page={{ wallpapers.next_page_number }}"><button>ä¸‹ä¸€é¡µ</button></a>
                <a href="?page={{ paginator.num_pages }}"><button>æœ«é¡µ</button></a>
            {% else %}
                <button disabled>ä¸‹ä¸€é¡µ</button>
                <button disabled>æœ«é¡µ</button>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- å£çº¸é¢„è§ˆå®¹å™¨ -->
    <div class="wallpaper-preview" id="wallpaperPreview">
        <img id="previewWallpaper" src="" alt="é¢„è§ˆ">
    </div>

    <!-- URLé¢„è§ˆå®¹å™¨ -->
    <div class="url-preview" id="urlPreview">
        <img id="urlPreviewImage" src="" alt="é¢„è§ˆ" style="display: none;">
        <div class="url-preview-text" id="urlPreviewText" style="display: none;"></div>
    </div>

    <!-- ä¸‹è½½å®Œæˆå¼¹çª— -->
    <div class="modal-overlay" id="downloadModal" role="dialog" aria-modal="true" aria-labelledby="downloadModalTitle" aria-hidden="true">
        <div class="modal-content">
            <h2 id="downloadModalTitle">ä¸‹è½½å®Œæˆ</h2>
            <p id="downloadModalMessage"></p>
            <button type="button" id="downloadModalClose" class="modal-close-btn">å¥½çš„</button>
        </div>
    </div>

    <!-- JavaScriptæ–‡ä»¶ -->
    <script src="{% static 'wallhaven/js/common.js' %}"></script>
    <script src="{% static 'wallhaven/js/all.js' %}"></script>
</body>
</html>
